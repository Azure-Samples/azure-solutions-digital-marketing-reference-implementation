{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
  "parameters": {
    "_artifactsLocation": {
      "type": "string"
    },
    "_artifactsLocationSasToken": {
      "type": "securestring"
    },
    "UniqueNamePrefix": {
      "type": "string",
      "minLength": 4,
      "maxLength": 13,
      "metadata": {
        "description": "A unique string to prefix all resource names in the deployment"
      }
    }
  },
  "variables": {
    "AppSvcName": "[concat(parameters('UniqueNamePrefix'), 'AppSvc', uniqueString(resourceGroup().id))]",
    "WebName": "[concat(parameters('UniqueNamePrefix'), 'Web', uniqueString(resourceGroup().id))]",
    "DocDBName": "[concat(parameters('UniqueNamePrefix'), 'DocDB', uniqueString(resourceGroup().id))]",
    "AzureKitStorageName": "[toLower(concat(parameters('UniqueNamePrefix'), uniqueString(resourceGroup().id)))]",
    "CacheName":  "[toLower(concat(parameters('UniqueNamePrefix'), uniqueString(resourceGroup().id)))]",
    "CoreTemplateURL": "[concat(parameters('_artifactsLocation'), '/AzureKit.Deployment/Templates/AzureKitCore.json')]"
  },
    "resources": [
        {
            "name": "InstallCore",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2015-01-01",
            "dependsOn": [ ],
          "properties": {
            "mode": "Incremental",
            "templateLink": {
              "uri": "[variables('CoreTemplateUrl')]",
              "contentVersion": "1.0.0.0"
            },
            "parameters": {
              "databaseAccountName": { "value": "[variables('DocDBName')]" },
              "AzureKitAppSvcName": { "value": "[variables('AppSvcName')]" },
              "AzureKitWebAppUniqueName": { "value": "[variables('WebName')]" },
              "AzureKitStorageName": { "value": "[variables('AzureKitStorageName')]" },
              "CacheSKUName": { "value": "Basic" },
              "CacheName":{"value": "[variables('CacheName')]"}
            
            }
            
          }
        }
    ],
  "outputs": {
    "databaseAccountName": {
      "type": "string",
      "value": "[reference('InstallCore').outputs.databaseName.value]"
    },
    "storageAccountName": {
      "type": "string",
      "value": "[reference('InstallCore').outputs.storageName.value]"
    },
    "databasePrimaryKey": {
      "type": "string",
      "value": "[reference('InstallCore').outputs.docDbKey.value]"
    }


  }
}
